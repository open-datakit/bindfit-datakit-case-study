{
  "title": "Bindfit",
  "description": "Binding constant fitter",
  "algorithms": [
    {
      "name": "bindfit",
      "title": "Bindfit",
      "code": "ZGVmIG1haW4oCiAgICBkYXRhLAogICAgcGFyYW1zLAogICAgb3B0aW9ucywKICAgIG91dHB1dHMsCiAgICAqKmt3YXJncywKKToKICAgIGltcG9ydCBudW1weSBhcyBucAogICAgaW1wb3J0IHBhbmRhcyBhcyBwZAoKICAgIGltcG9ydCBiaW5kZml0CgoKICAgICMgQ29udmVydCBwYXJhbXMgdG8gQmluZGZpdCBmb3JtYXQKICAgICMgVE9ETzogTW9kaWZ5IGxpYnJhcnkgdG8gYWNjZXB0IEZyaWN0aW9ubGVzcyBwYXJhbXMgZm9ybWF0CiAgICBiaW5kZml0X3BhcmFtcyA9IHt9CgogICAgZm9yIGtleSwgcGFyYW0gaW4gcGFyYW1zWyJkYXRhIl0uaXRlbXMoKToKICAgICAgICBiaW5kZml0X3BhcmFtcy51cGRhdGUoewogICAgICAgICAgICBrZXk6IHsKICAgICAgICAgICAgICAgICJpbml0IjogcGFyYW1bInZhbHVlIl0sCiAgICAgICAgICAgICAgICAiYm91bmRzIjogewogICAgICAgICAgICAgICAgICAgICJtaW4iOiBwYXJhbVsibG93ZXJCb3VuZCJdLAogICAgICAgICAgICAgICAgICAgICJtYXgiOiBwYXJhbVsidXBwZXJCb3VuZCJdLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQogICAgICAgIH0pCgogICAgbW9kZWwgPSBwYXJhbXNbIm1ldGFkYXRhIl1bIm1vZGVsIl1bIm5hbWUiXQoKICAgICMgQmluZGZpdCBvcHRpb25zCiAgICBtZXRob2QgPSBvcHRpb25zWyJkYXRhIl1bIm1ldGhvZCJdCiAgICBub3JtYWxpc2UgPSBvcHRpb25zWyJkYXRhIl1bIm5vcm1hbGlzZSJdCiAgICBkaWx1dGUgPSBvcHRpb25zWyJkYXRhIl1bImRpbHV0ZSJdCiAgICBmbGF2b3VyID0gb3B0aW9uc1siZGF0YSJdWyJmbGF2b3VyIl0KCiAgICAjIExvYWQgZGF0YQogICAgIyBUT0RPOiBTcGxpdCB0aGlzIGZ1bmN0aW9uIG91dCBpbnRvIGRhdGFwYWNrYWdlLXV0aWxpdGllcyBsaWJyYXJ5CiAgICBkZWYgZGF0YXBhY2thZ2VfdG9fZGF0YWZyYW1lKGRwKToKICAgICAgICBkZiA9IHBkLkRhdGFGcmFtZS5mcm9tX2RpY3QoZHBbImRhdGEiXSkKICAgICAgICAjIFJlb3JkZXIgY29sdW1ucyBieSBzY2hlbWEgZmllbGQgb3JkZXIKICAgICAgICBjb2xzID0gWyBmaWVsZFsibmFtZSJdIGZvciBmaWVsZCBpbiBkcFsic2NoZW1hIl1bImZpZWxkcyJdIF0KICAgICAgICBkZiA9IGRmW2NvbHNdCiAgICAgICAgcmV0dXJuIGRmCgogICAgZGYgPSBkYXRhcGFja2FnZV90b19kYXRhZnJhbWUoZGF0YSkKCiAgICAjIEJpbmRmaXQgZXhwZWN0cyBlYWNoIHZhcmlhYmxlIGFzIHJvd3MKICAgIGRhdGFfeCA9IG5wLnRyYW5zcG9zZShkZi5pbG9jWzosIDoyXS50b19udW1weSgpKQogICAgZGF0YV95ID0gbnAudHJhbnNwb3NlKGRmLmlsb2NbOiwgMjpdLnRvX251bXB5KCkpCgogICAgIyBBcHBseSBkaWx1dGlvbiBjb3JyZWN0aW9uCiAgICAjIFRPRE86IFRoaW5rIGFib3V0IHdoZXJlIHRoaXMgc2hvdWxkIGdvIC0gZml0dGVyIG9yIGZ1bmN0aW9uPwogICAgIyBPciBqdXN0IGFwcGx5IGl0IGJlZm9yZSB0aGUgZml0PwogICAgaWYgZGlsdXRlOgogICAgICAgIGRhdGFfeSA9IGJpbmRmaXQuaGVscGVycy5kaWx1dGUoZGF0YV94WzBdLCBkYXRhX3kpCgogICAgZnVuY3Rpb24gPSBiaW5kZml0LmZ1bmN0aW9ucy5jb25zdHJ1Y3QoCiAgICAgICAgbW9kZWwsCiAgICAgICAgbm9ybWFsaXNlPW5vcm1hbGlzZSwKICAgICAgICBmbGF2b3VyPWZsYXZvdXIsCiAgICApCgogICAgZml0dGVyID0gYmluZGZpdC5maXR0ZXIuRml0dGVyKAogICAgICAgIGRhdGFfeCwgZGF0YV95LCBmdW5jdGlvbiwgbm9ybWFsaXNlPW5vcm1hbGlzZSwgcGFyYW1zPWJpbmRmaXRfcGFyYW1zCiAgICApCgogICAgZml0dGVyLnJ1bl9zY2lweShiaW5kZml0X3BhcmFtcywgbWV0aG9kPW1ldGhvZCkKCiAgICBzdW1tYXJ5ID0gewogICAgICAgICJmaXR0ZXIiOiBtb2RlbCwKICAgICAgICAiZml0IjogewogICAgICAgICAgICAieSI6IGZpdHRlci5maXQsCiAgICAgICAgICAgICJjb2VmZnNfcmF3IjogZml0dGVyLmNvZWZmc19yYXcsCiAgICAgICAgICAgICJjb2VmZnMiOiBmaXR0ZXIuY29lZmZzLAogICAgICAgICAgICAibW9sZWZyYWNfcmF3IjogZml0dGVyLm1vbGVmcmFjX3JhdywKICAgICAgICAgICAgIm1vbGVmcmFjIjogZml0dGVyLm1vbGVmcmFjLAogICAgICAgICAgICAicGFyYW1zIjogZml0dGVyLnBhcmFtcywKICAgICAgICAgICAgIm5feSI6IG5wLmFycmF5KGZpdHRlci5maXQpLnNpemUsCiAgICAgICAgICAgICJuX3BhcmFtcyI6IGxlbihmaXR0ZXIucGFyYW1zKSArIG5wLmFycmF5KGZpdHRlci5jb2VmZnNfcmF3KS5zaXplLAogICAgICAgIH0sCiAgICAgICAgInFvZiI6IHsKICAgICAgICAgICAgInJlc2lkdWFscyI6IGZpdHRlci5yZXNpZHVhbHMsCiAgICAgICAgICAgICJzc3IiOiBiaW5kZml0LmhlbHBlcnMuc3NyKGZpdHRlci5yZXNpZHVhbHMpLAogICAgICAgICAgICAicm1zIjogYmluZGZpdC5oZWxwZXJzLnJtcyhmaXR0ZXIucmVzaWR1YWxzKSwKICAgICAgICAgICAgImNvdiI6IGJpbmRmaXQuaGVscGVycy5jb3YoZGF0YV95LCBmaXR0ZXIucmVzaWR1YWxzKSwKICAgICAgICAgICAgInJtc190b3RhbCI6IGJpbmRmaXQuaGVscGVycy5ybXMoZml0dGVyLnJlc2lkdWFscywgdG90YWw9VHJ1ZSksCiAgICAgICAgICAgICJjb3ZfdG90YWwiOiBiaW5kZml0LmhlbHBlcnMuY292KGRhdGFfeSwgZml0dGVyLnJlc2lkdWFscywgdG90YWw9VHJ1ZSksCiAgICAgICAgfSwKICAgICAgICAidGltZSI6IGZpdHRlci50aW1lLAogICAgICAgICJvcHRpb25zIjogewogICAgICAgICAgICAiZGlsdXRlIjogZGlsdXRlLAogICAgICAgICAgICAibm9ybWFsaXNlIjogbm9ybWFsaXNlLAogICAgICAgICAgICAibWV0aG9kIjogbWV0aG9kLAogICAgICAgICAgICAiZmxhdm91ciI6IGZsYXZvdXIsCiAgICAgICAgfSwKICAgIH0KCiAgICAjIFRPRE86IFRoaXMgY29udmVyc2lvbiBzaG91bGQgYmUgbW92ZWQgdG8gQmluZGZpdCBsaWJyYXJ5CiAgICBmb3Iga2V5LCBwYXJhbSBpbiBmaXR0ZXIucGFyYW1zLml0ZW1zKCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBvdXRwdXRzWyJwYXJhbXMiXVsiZGF0YSJdLnVwZGF0ZSh7CiAgICAgICAgICAgICAgICBrZXk6IHsKICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBwYXJhbVsidmFsdWUiXSwKICAgICAgICAgICAgICAgICAgICAic3RkZXJyIjogcGFyYW1bInN0ZGVyciJdLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfSkKICAgICAgICBleGNlcHQgS2V5RXJyb3I6CiAgICAgICAgICAgICMgTm8gZXhpc3RpbmcgZGF0YSBrZXksIGNyZWF0ZQogICAgICAgICAgICBvdXRwdXRzWyJwYXJhbXMiXSA9IHsKICAgICAgICAgICAgICAgICJkYXRhIjogewogICAgICAgICAgICAgICAgICAgIGtleTogewogICAgICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBwYXJhbVsidmFsdWUiXSwKICAgICAgICAgICAgICAgICAgICAgICAgInN0ZGVyciI6IHBhcmFtWyJzdGRlcnIiXSwKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgfQoKICAgICMgVE9ETzogVGhpbmsgb2YgYSBiZXR0ZXIgd2F5IG9mIGRvaW5nIHRoaXM/CiAgICAjIFBvcHVsYXRlIG91dHB1dCBwYXJhbXMgc2NoZW1hIGFuZCBtZXRhZGF0YSBmcm9tIGlucHV0IHBhcmFtcwogICAgb3V0cHV0c1sicGFyYW1zIl1bIm1ldGFkYXRhIl0gPSBwYXJhbXNbIm1ldGFkYXRhIl0KICAgIG91dHB1dHNbInBhcmFtcyJdWyJzY2hlbWEiXSA9IHBhcmFtc1sic2NoZW1hIl0KCiAgICAjIFRyYW5zbGF0ZSBmaXR0ZXIuZml0IGludG8gSlNPTiBmb3IgdGFidWxhciBkYXRhIHNjaGVtYQogICAgIyBUT0RPOiBUaGlzIHNob3VsZCBiZSBkb25lIGJ5IHRoZSBCaW5kZml0IGxpYnJhcnkKICAgIGRlZiBmaXRfdG9fanNvbihkYXRhLCBmaXQpOgogICAgICAgIHhfZmllbGRzID0gWyBpWyJuYW1lIl0gZm9yIGkgaW4gZGF0YVsic2NoZW1hIl1bImZpZWxkcyJdWzoyXSBdCiAgICAgICAgeV9maWVsZHMgPSBbIGlbIm5hbWUiXSBmb3IgaSBpbiBkYXRhWyJzY2hlbWEiXVsiZmllbGRzIl1bMjpdIF0KCiAgICAgICAgZml0X2RhdGEgPSBbXQoKICAgICAgICBmb3IgZGF0YV9yb3csIGZpdF9yb3cgaW4gemlwKGRhdGFbImRhdGEiXSwgZml0LlQpOgogICAgICAgICAgICByb3cgPSB7fQoKICAgICAgICAgICAgZm9yIGZpZWxkIGluIHhfZmllbGRzOgogICAgICAgICAgICAgICAgcm93W2ZpZWxkXSA9IGRhdGFfcm93W2ZpZWxkXQoKICAgICAgICAgICAgZm9yIGksIGZpZWxkIGluIGVudW1lcmF0ZSh5X2ZpZWxkcyk6CiAgICAgICAgICAgICAgICByb3dbZmllbGRdID0gZml0X3Jvd1tpXQoKICAgICAgICAgICAgZml0X2RhdGEuYXBwZW5kKHJvdykKCiAgICAgICAgcmV0dXJuIGZpdF9kYXRhCgogICAgb3V0cHV0c1siZml0Il1bImRhdGEiXSA9IGZpdF90b19qc29uKGRhdGEsIGZpdHRlci5maXQpCiAgICBvdXRwdXRzWyJmaXQiXVsic2NoZW1hIl0gPSBkYXRhWyJzY2hlbWEiXQoKICAgIG91dHB1dHNbInJlc2lkdWFscyJdWyJkYXRhIl0gPSBmaXRfdG9fanNvbihkYXRhLCBmaXR0ZXIuZml0IC0gZGF0YV95KQogICAgb3V0cHV0c1sicmVzaWR1YWxzIl1bInNjaGVtYSJdID0gZGF0YVsic2NoZW1hIl0KCiAgICByZXR1cm4gb3V0cHV0cwo=",
      "inputs": [
        {
          "name": "data",
          "type": "resource",
          "resource": "inputData"
        },
        {
          "name": "params",
          "type": "enum",
          "resource": "inputParamsNMR12",
          "enum": [
            "inputParamsNMR11",
            "inputParamsNMR12"
          ]
        },
        {
          "name": "options",
          "type": "resource",
          "resource": "inputOptions"
        }
      ],
      "outputs": [
        {
          "name": "params",
          "type": "resource",
          "resource": "outputParams"
        },
        {
          "name": "fit",
          "type": "resource",
          "resource": "outputFit"
        },
        {
          "name": "residuals",
          "type": "resource",
          "resource": "outputResiduals"
        }
      ]
    }
  ],
  "resources": [
    {
      "name": "inputData",
      "title": "Input data",
      "description": "Input data",
      "profile": "tabular-data-resource",
      "data": [],
      "schema": {
        "primaryKey": "",
        "fields": []
      }
    },
    {
      "name": "inputParamsNMR11",
      "title": "Input parameters",
      "description": "Initial parameter values",
      "profile": "parameter-data-resource",
      "metadata": {
        "model": {
          "name": "nmr1to1",
          "title": "NMR 1:1"
        }
      },
      "data": {
        "k": {
          "vary": true,
          "value": 100,
          "lowerBound": 0,
          "upperBound": 1000
        }
      },
      "schema": {
        "keys": [
          {
            "name": "k",
            "unit": "M^{-1}",
            "fields": [
              {
                "name": "vary",
                "title": "Vary",
                "type": "boolean"
              },
              {
                "name": "value",
                "title": "Value",
                "type": "number"
              },
              {
                "name": "lowerBound",
                "title": "Lower bound",
                "type": "number"
              },
              {
                "name": "upperBound",
                "title": "Upper bound",
                "type": "number"
              }
            ]
          }
        ]
      }
    },
    {
      "name": "inputParamsNMR12",
      "title": "Input parameters",
      "description": "Initial parameter values",
      "profile": "parameter-data-resource",
      "metadata": {
        "model": {
          "name": "nmr1to2",
          "title": "NMR 1:2"
        }
      },
      "data": {
        "k11": {
          "vary": true,
          "value": 1000,
          "lowerBound": 0,
          "upperBound": null
        },
        "k12": {
          "vary": true,
          "value": 100,
          "lowerBound": 0,
          "upperBound": null
        }
      },
      "schema": {
        "keys": [
          {
            "name": "k11",
            "unit": "M^{-1}",
            "fields": [
              {
                "name": "vary",
                "title": "Vary",
                "type": "boolean"
              },
              {
                "name": "value",
                "title": "Value",
                "type": "number"
              },
              {
                "name": "lowerBound",
                "title": "Lower bound",
                "type": "number"
              },
              {
                "name": "upperBound",
                "title": "Upper bound",
                "type": "number"
              }
            ]
          },
          {
            "name": "k12",
            "unit": "M^{-1}",
            "fields": [
              {
                "name": "vary",
                "title": "Vary",
                "type": "boolean"
              },
              {
                "name": "value",
                "title": "Value",
                "type": "number"
              },
              {
                "name": "lowerBound",
                "title": "Lower bound",
                "type": "number"
              },
              {
                "name": "upperBound",
                "title": "Upper bound",
                "type": "number"
              }
            ]
          }
        ]
      }
    },
    {
      "name": "inputOptions",
      "title": "Fit options",
      "description": "Fit options",
      "profile": "options-data-resource",
      "data": {
        "method": "Nelder-Mead",
        "normalise": true,
        "dilute": false,
        "flavour": "none"
      },
      "schema": {
        "fields": [
          {
            "name": "method",
            "title": "Fit method",
            "description": "The optimisation method to use for fitting",
            "type": "object",
            "objectFields": [
              {
                "name": "title",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              }
            ],
            "constraints": {
              "enum": [
                {
                  "title": "Nelder-Mead",
                  "name": "Nelder-Mead"
                },
                {
                  "title": "L-BFGS-B",
                  "name": "L-BFGS-B"
                }
              ]
            }
          },
          {
            "name": "normalise",
            "title": "Subtract initial values",
            "description": "Subtract initial values from data before fitting",
            "type": "boolean"
          },
          {
            "name": "dilute",
            "title": "Dilution correction",
            "description": "Apply dilution correction to data",
            "type": "boolean"
          },
          {
            "name": "flavour",
            "title": "Flavour",
            "description": "Fitting algorithm flavour",
            "type": "object",
            "objectFields": [
              {
                "name": "title",
                "type": "string"
              },
              {
                "name": "name",
                "type": "string"
              }
            ],
            "constraints": {
              "enum": [
                {
                  "title": "None (Full)",
                  "name": "none"
                },
                {
                  "title": "Non-cooperative",
                  "name": "noncoop"
                },
                {
                  "title": "Additive",
                  "name": "add"
                },
                {
                  "title": "Statistical",
                  "name": "stat"
                }
              ]
            }
          }
        ]
      }
    },
    {
      "name": "outputParams",
      "title": "Optimised parameters",
      "description": "Optimised parameter values",
      "profile": "parameter-data-resource",
      "metadata": {},
      "data": {},
      "schema": {}
    },
    {
      "name": "outputFit",
      "title": "Fit",
      "description": "Output fit",
      "profile": "tabular-data-resource",
      "data": [],
      "schema": {
        "primaryKey": "",
        "fields": []
      }
    },
    {
      "name": "outputResiduals",
      "title": "Residuals",
      "description": "Fit residuals",
      "profile": "tabular-data-resource",
      "data": [],
      "schema": {
        "primaryKey": "",
        "fields": []
      }
    }
  ],
  "views": [
    {
      "name": "upload",
      "specType": "opendatafit-upload",
      "spec": {},
      "resources": [
        "inputData"
      ]
    },
    {
      "name": "params",
      "title": "Parameters",
      "specType": "opendatafit-params",
      "spec": {
        "keys": [
          {
            "name": "k"
          }
        ],
        "parameterSpace": {
          "type": "algorithmInput",
          "algorithm": "bindfit",
          "name": "params"
        }
      },
      "resources": {
        "input": {
          "type": "algorithmInput",
          "algorithm": "bindfit",
          "name": "params"
        },
        "output": {
          "type": "resource",
          "name": "outputParams"
        }
      }
    },
    {
      "name": "dataTable",
      "title": "Input data",
      "spec": {},
      "specType": "opendatafit-table",
      "resources": [
        "inputData"
      ]
    },
    {
      "name": "fitTable",
      "title": "Fit data",
      "spec": {},
      "specType": "opendatafit-table",
      "resources": [
        "outputFit"
      ]
    },
    {
      "name": "fitGraph",
      "spec": {
        "data": [
          {
            "name": "inputData",
            "x": {
              "transform": {
                "type": "formula",
                "expr": "datum[1]/datum[0]"
              }
            },
            "y": {
              "transform": {
                "type": "formula",
                "expr": "datum.slice(2)"
              }
            },
            "colors": {
              "attributePath": "marker.color",
              "values": [
                "darkcyan",
                "darkslateblue",
                "darkmagenta",
                "crimson"
              ]
            },
            "config": {
              "mode": "markers",
              "type": "scatter",
              "marker": {
                "size": 8,
                "color": "",
                "symbol": "circle-open-dot"
              }
            }
          },
          {
            "name": "outputFit",
            "x": {
              "transform": {
                "type": "formula",
                "expr": "datum[1]/datum[0]"
              }
            },
            "y": {
              "transform": {
                "type": "formula",
                "expr": "datum.slice(2)"
              }
            },
            "colors": {
              "attributePath": "line.color",
              "values": [
                "darkcyan",
                "darkslateblue",
                "darkmagenta",
                "crimson"
              ]
            },
            "config": {
              "mode": "lines",
              "type": "scatter",
              "line": {
                "width": 1,
                "color": "",
                "shape": "spline"
              }
            }
          },
          {
            "name": "outputResiduals",
            "x": {
              "transform": {
                "type": "formula",
                "expr": "datum[1]/datum[0]"
              }
            },
            "y": {
              "transform": {
                "type": "formula",
                "expr": "datum.slice(2)"
              }
            },
            "colors": {
              "attributePath": "line.color",
              "values": [
                "darkcyan",
                "darkslateblue",
                "darkmagenta",
                "crimson"
              ]
            },
            "config": {
              "mode": "lines",
              "type": "scatter",
              "yaxis": "y2",
              "line": {
                "width": 1,
                "color": ""
              }
            }
          }
        ],
        "layout": {
          "title": {
            "text": "Bindfit"
          },
          "xaxis": {
            "title": {
              "text": "Equivalent total [G]<sub>0</sub>/[H]<sub>0</sub>"
            },
            "exponentformat": "power",
            "domain": [
              0,
              1
            ],
            "side": "bottom",
            "type": "linear",
            "autorange": true,
            "automargin": true
          },
          "yaxis": {
            "title": {
              "text": "$\\delta$"
            },
            "ticksuffix": " ppm",
            "exponentformat": "power",
            "domain": [
              0.375,
              1
            ],
            "side": "left",
            "type": "linear",
            "autorange": true
          },
          "yaxis2": {
            "title": {
              "text": "Residuals"
            },
            "ticksuffix": " ppm",
            "exponentformat": "power",
            "domain": [
              0,
              0.25
            ],
            "side": "left",
            "type": "linear",
            "autorange": true
          },
          "autosize": true,
          "hovermode": "x",
          "showlegend": true,
          "legend": {
            "traceorder": "grouped"
          }
        }
      },
      "specType": "plotly",
      "resources": [
        "inputData",
        "outputFit",
        "outputResiduals"
      ]
    }
  ],
  "displays": [
    {
      "name": "main",
      "algorithms": [
        "bindfit"
      ],
      "layout": {
        "type": "bindfit",
        "spec": {
          "panes": [
            {
              "name": "control",
              "tabs": [
                "control"
              ]
            },
            {
              "name": "main",
              "tabs": [
                "fit",
                "data"
              ]
            }
          ],
          "tabs": [
            {
              "name": "control",
              "title": "Options",
              "icon": "",
              "views": [
                "upload",
                "params"
              ]
            },
            {
              "name": "fit",
              "title": "Fit",
              "icon": "",
              "views": [
                "fitGraph"
              ]
            },
            {
              "name": "data",
              "title": "Data",
              "icon": "",
              "views": [
                "dataTable",
                "fitTable"
              ]
            }
          ]
        }
      }
    }
  ]
}